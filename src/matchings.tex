\chapter{Matchings}
\begin{definition}[Matching]
    A matching is a set of vertex-disjoint edges.    
\end{definition}
A matching in $G$ is maximum if no other matching in $G$ has more edges. A very important detail needs to be clarified at this point: \textbf{maximum} $\neq$ \textbf{maximal}, explained easily:
\begin{itemize}
    \item [\textbf{Maximum:}] The greatest in size
    \item [\textbf{Maximal:}] It cannot be extended
\end{itemize}
This means that:
\begin{equation}
    \text{\textbf{Maximum}} \implies \text{\textbf{Maximal}} \:\:\text{but}\:\: \text{\textbf{Maximal}} \nimplies \text{\textbf{Maximum}}
\end{equation}
Let $G$ be a graph and $M$ a matching in $G$, an augmenting path in $G$ with respect to $M$ is a path in $G$ which starts at an unmatched vertex and alternates between edges of $\e \setminus M$ and $M$, and ends at an unmatched vertex. Note that $\e[P] \setminus M$ is a matching containing one edge more than $M$.
\begin{customlemma}{2.1}
\label{lemma:2.1}
    A matching is maximum $\iff$ it has no augmenting path.
\end{customlemma}
An alternating path is a path starting at an unmatched vertex and alternates between edges of $\e \setminus M$ and $M$.
\section{Bipartite Matchings}
\begin{definition}[Vertex cover]
    A vertex cover is a set $U$ of vertices such that each edge of $G$ has an endpoint in $U$.
\end{definition}
\begin{customtheorem}{(KÃ¶nig)}
\label{theorem:konig}
    Let $G$ be a bipartite graph: the maximum size of a matching in $G$ is the maximum size of a vertex cover of $G$.
\end{customtheorem}
\begin{prf}
    Let $M$ be a maximum matching and $U$ be a minimum vertex cover. If $|M| \leq |U|:\:U$ is a vertex cover, which means that for each $e \in M$ one of the endpoints of $e$ is in $U$. Since the edges in $M$ are disjoint, we need $|M|$ vertices in $V$ to cover $M$.

    Denote by $(A, B)$ the bipartition of $G$, construct a set $U \subseteq \v$ as follows: For each $a, b \in M$, where $a \in A$ and $b \in B$ if $G$ has an alternating path starting in $A$ and ending in $b$ then add $b$ to $U$, otherwise we add $a$ to $U$. By construction $|M| = |U|$. It remains to show that $U$ is a vertex cover.

    By definition of $U$, each $e \in M$ has an endpoint in $U$, so let $ab \in \e \setminus M, a \in A, b \in B^*$. For a contradiction, suppose both $a, b \notin U$, since $M$ is maximum, at least one between $a$ and $b$ is incident to an edge of $M$. If there is an alternating path $P$ starting in $A$ and ending at $b$, then, by definition of $U$, $b$ cannot be incident to an edge of $M$, so $P$ is an augmenting path. Since $P$ is an augmenting path then $M$ is not maximum, but that is a contradiction of the fact that $M$ is maximum (by Lemma \ref{lemma:2.1}).

    If $a$ is unmatched, then $ab$ would be such an alternating path. So $\ex ab' \in M$ since $a \notin U$ by assumption, there exists an alternating path $Q$ which starts in $A$ and ends at $b'$. If $a, b \notin \v[Q]$ then $Qb'ab$ would be an alternating path starting in $A$ and ending at $b$, which is absurd. If $b \in \v[Q]$ then $a'Qb$ is an alternating path, which is absurd.

    If $a \in \v[Q]$, then $a$ is matched, it must be an internal vertex of $Q$ and so since $Q$ is alternating $ab'$ must be in $Q$. Since $G$ is bipartite and the first vertex of $Q$ is unmatched, we must have that $b'$ is also an internal vertex. Which is absurd.\qed
\end{prf}
Given a graph $G$ and $A \subseteq \v$, a matching of $A$ in $G$ is a matching $M$ such that every $a \in A$ is incident to an edge of $M$. For $X \subseteq \v, \ngbrs{X} = \bigcup_{x \in X} \ngbrs{x} \setminus X$.
\begin{customtheorem}{(Hall)}
\label{theorem:hall}
    Let $G = (A \cup B, E)$ be a bipartite graph. Then $G$ has a matching of $A$ if an only if
    \begin{equation*}
        |\ngbrs{X}| \geq |X| \text{for all $X \subseteq A$}
    \end{equation*}
\end{customtheorem}
\begin{prf}
    To prove the theorem we will prove the two directions separately
    \begin{itemize}
        \item [($\implies$)] Let $M$ be a matching of $A$ note that for each $X \subseteq A$, each $x \in X$ is matched to a different $b_x \in B$.
        \item [($\impliedby$)] $|\ngbrs{X}| \geq |\grf{b_x \st x \in X} = |X|$
        
        By Theorem \ref{theorem:konig}, $G$ has a matching $M$ and a vertex cover $U$ of the same cardinality. We want to show that $M$ is a matching of $A$.

        Since $|M| = |U|, U$ consists of precisely one endpoint of each edge of $M$. Let $A_U = A \cap U$ and $B_U = B \cap U$ and $A' = \grf{a \in A \st \ex b \in B_U \st ab \in M}$. By the observation above, $U = A_U \cap B_U$ and $A_U \cap A' \neq \emptyset$, moreover each vertex is in $A_U \cup A'$ is incident to an edge of $M$. And $|A'| = |B_U|$ thus
        \begin{equation*}
            |A \setminus A'| \leq |\ngbrs{A \setminus A_U}| \leq |B_U|
        \end{equation*}
        but $|B_U| = |A'| \leq |A \setminus A_U|$, thus the equality holds throughout this string of inequalities. In particular, $|A'| = |A \setminus A_U|$. So $A = A_U \cup A'$ and, as already observed, each vertex of $A$ is matched.\qed
    \end{itemize}
\end{prf}
Let $G$ be a graph. A matching $M$ in $G$ is perfect if $\v[M] = \v$. A perfect matching is also called a $1$-factor. More generally, a $k$-factor in $G$ is a spanning $k$-regular subgraph in $G$.
\begin{customcorollary}{2.4}
\label{corollary:2.4}
    Let $k \geq 1$ and $k$-regular bipartite graph has a perfect matching.
\end{customcorollary}
\begin{prf}
    Let $(A, B)$ be the bipartition of $G$. Since $G$ is $k$-regular then $k \cdot |A| = \ne = k \cdot |B|$.
    \begin{equation*}
        k \cdot |A| = \sum_{v \in A}\deg{v} = \ne = \sum_{v \in B}\deg{v} = k \cdot |B|
    \end{equation*}
    So a matching of $A$ is a perfect matching, thus by Theorem \ref{theorem:hall} it is enough to check Hall's condition. Let $X \subseteq A$. If $|X| \leq k$, then the degree condition implies $|\ngbrs{x}| \geq k \geq |X|$. Suppose $|X| > k$
    \begin{equation*}
        |X| \cdot k = \ne[G[X \cup \ngbrs{X}]] \leq k \cdot |\ngbrs{x}|\\
        |\ngbrs{X}| \geq |X|
    \end{equation*}
    And that proves the theorem.\qed
\end{prf}
\begin{customcorollary}{2.5}
\label{corollary:2.5}
    Let $k \geq 1$. Any $2k$-regular graph has a $2$-factor.
\end{customcorollary}
\begin{prf}
    Let $G$ be a $2k$-regular graph. If $G$ is disconnected then if is enough to find a $2$-factor in each component, os we can assume without loss of generality that $G$ is connected. So by Theorem \ref{theorem:euler} $G$ has an Euler tour.

    If we take a generic graph, we can then split any vertex into two (we can split for example $v$ into $v^+$ and $v^-$, where $v^-$ is the incoming portion and $v^+$ is the outgoing portion). Thus every vertex has $k$ incoming edges and $k$ outgoing edges. Now the graph is bipartite because we can divide the vertices keeping the links that are already in the graph. If we merge vertices again we get a $2$-factor.

    % TODO: CHECK THE FORMULA FOR THE EDGE SET
    Define a directed graph $D$, by orienting the edges along $w$, more precisely $\v[D] = \v$ and $\e[D] = \{(v_i, v_{i + 1}): i \in [\dots]\}$. Note that each vertex in $D$ is incident to $k$ ingoing edges and $k$ outgoing edges in $D$.

    Define an auxiliary undirected graph $H$ as follows:
    \begin{itemize}
        \item $\v[H] = \{v^+, v^-: v \in \v[D]\}$
        \item $\e[H] = \{v^+, v^-: (u, v) \in \e[D]\}$ thus $\ngbrs[H]{v^+}$ is the set of out-neihbours of $v$ in $D$ and $\ngbrs[H]{v^-}$ is the set of in-neighbours in $D$.
    \end{itemize}
    Note that $H$ is $k$-regular and bipartite with bipartition $(V^+, V^-)$ where:
    \begin{itemize}
        \item $V^+ = \{v^+: v \in \v[D]\}$
        \item $V^- = \{v^-: v \in \v[D]\}$
    \end{itemize}
    By Corollary \ref{corollary:2.4} $H$ has perfect matching $M$. We construct a $2$-factor $F$ from $M$ as follows
    \begin{align*}
        &\v[F] = \v[M] = \v[H] = \v[D] = \v\\
        &\e[F] = \{uv\st u^-v^+ \in M \lor v^-u^+ \in M\}
    \end{align*}
    Note that for $v \in \v$, $v^+$ and $v^-$ are incident to an edge in $M$ and $v^-v^+ \notin M$. Since otherwise there would have been a loop at $v$ in $G$. We check $F \subseteq G$. Suppose $uv \in \e[F]$ then without loss of generality $u^-v^+ \in M \subseteq \e[H]$ thus $(u, v) \in \e[D] \implies uv \in \e$ \qed
\end{prf}
Let $G$ be a graph. We denote by $\mathit{q}$ the number of odd components of $G$.
\begin{customtheorem}{Tutte}
\label{theorem:tutte}
    A graph $G$ has a perfect matching if and only if, for every subset $U$ of $V$ the subgraph $G - U$ has at omost $|U|$ odd components.
\end{customtheorem}
\begin{customtheorem}{Gallai-Edmonds decomposition}
\label{theorem:gallai-edmonds}
    For any graph $G$ there exists $S^* \subseteq \v$ such that:
    \begin{enumerate}
        \item All odd components of $G - S^*$ are factor critical.
        \item All even components of $G - S^*$ have a perfect matching.
        \item For all $\emptyset \neq X \subseteq S^*$, the set $\ngbrs{X}$ intersects $> |X|$ odd components of $G - S^*$.
    \end{enumerate}
\end{customtheorem}
A graph $G$ is factor-critical if $G - v$ has a perfect maching for each $v \in \v$ any odd cycle and odd complete graph are factor-critical.
% TODO: UNDERSTAND WHAT IS THIS
\begin{enumerate}
    \item Keep the matchings.
    \item Match $S^*$ to the odd components.
    \item Removing the vertices in the odd components because of factor criticality.
\end{enumerate}
\begin{customlemma}{2.8}
\label{lemma:2.8}
    Let $G$ be a graph and suppose $S^* \subseteq \v$ satisfies properly $1$ and $2$ of the last theorem, as well as $3'$ and $3$ but with $\geq |X|$.
\end{customlemma}
Then $G$ has a matching which covers all but at most $\mathit{q}(G - S^*) - |S^*|$ vertices.
\begin{prf}
    Let $V_E$ be the set of vertices in an even component of $G - S^*$. By \ref{theorem:gallai-edmonds} (second point) $G[V_E]$ has a perfect matching $M_E$.

    Let $C$ be the set of odd components of $G - S^*$. Define an auxiliary bipartite graph $H$ on $(S^*, C)$ such that $S \in S^*, C \in \mathcal{C}$ are adjacent in $H$ if and only if $S$ has a neighbour in $C$. By $3'$ for all $X \subseteq S^*, |\ngbrs[H]{X}| \geq |X|$. Then, by \ref{theorem:hall}'s theorem: $H$ has a matching $M$ of $S^*$.

    By definition of $H$, for each edge $sC \in M$, there exists a vertex $V_S \in \v[C] \cap \ngbrs{S}$ thus this induces a matching $M_{S^*}$ of $S^*$ in $G$. By construction, $M_{S^*}$ covers $\leq 1$ vertex from each component in $\mathcal{C}$.

    Let $M_O$ consist of:
    \begin{itemize}
        \item For each $C \in \mathcal{C}$ not coverted by $M_{S^*}$ a matching of $C$ missing one vertex (exists by 1).
        \item For each $C \in \mathcal{C}$ such that $\ex v \in \v[C] \cap \v[M^*]$ a perfect matching of $C - V$.
    \end{itemize}
    Then $M_E \cup M_{S^*} \cup M_O$ is a matching in $G$ missing $\mathit{q}(G - S^*) - |S^*|$ vertices.\qed
\end{prf}
\begin{prf}
    We are now going to prove \ref{theorem:tutte}'s theorem.
    \begin{itemize}
        \item[($\impliedby$)] Apply \ref{theorem:gallai-edmonds} to get $S^*$. By Lemma \ref{lemma:2.8} we have a matching missing $\leq \mathit{q}(G - S^*) - |S^*| \leq 0$ (this by \ref{theorem:tutte}'s theorem condition). But that is the amount of vertices missing from a perfect matching.
        \item[($\implies$)] Let $S \subseteq \v$ and $M$ a perfect matching for each odd component $C$ of $G - S$. There is a vertex of $C$ which is matchied to a vertex, that is $|S| \geq \mathit{q}(G, S)$\qed
    \end{itemize}
\end{prf}